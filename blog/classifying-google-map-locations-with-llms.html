<!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Using LLMs to automatically tag and categorize your favourite eating spots"><link rel=canonical href=https://ivanleo.com/blog/classifying-google-map-locations-with-llms.html><link rel=prev href=whispers-in-the-background.html><link rel=next href=reinventing-gandalf.html><link rel=alternate type=application/rss+xml title="RSS feed" href=../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../feed_rss_updated.xml><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.44"><title>Classifying Google Map locations with LLMs - Ivan's Blog</title><link rel=stylesheet href=../assets/stylesheets/main.0253249f.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-MM8QMY5JWN"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-MM8QMY5JWN",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-MM8QMY5JWN",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta property=og:type content=website><meta property=og:title content="Classifying Google Map locations with LLMs - Ivan's Blog"><meta property=og:description content="Using LLMs to automatically tag and categorize your favourite eating spots"><meta property=og:image content=https://ivanleo.com/assets/images/social/blog/posts/automatic-tagging-with-gpt.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta property=og:url content=https://ivanleo.com/blog/classifying-google-map-locations-with-llms.html><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Classifying Google Map locations with LLMs - Ivan's Blog"><meta name=twitter:description content="Using LLMs to automatically tag and categorize your favourite eating spots"><meta name=twitter:image content=https://ivanleo.com/assets/images/social/blog/posts/automatic-tagging-with-gpt.png></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#introduction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title="Ivan's Blog" class="md-header__button md-logo" aria-label="Ivan's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Ivan's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Classifying Google Map locations with LLMs </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../index.html class=md-tabs__link> About me </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=index.html class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../work.html class=md-tabs__link> Work with me </a> </li> <li class=md-tabs__item> <a href=../newsletter.html class=md-tabs__link> Newsletter </a> </li> <li class=md-tabs__item> <a href=../talk.html class=md-tabs__link> Talks </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title="Ivan's Blog" class="md-nav__button md-logo" aria-label="Ivan's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Ivan's Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <span class=md-ellipsis> About me </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <a href=index.html class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=archive/2025.html class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=archive/2024.html class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> <li class=md-nav__item> <a href=archive/2023.html class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=category/ai.html class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=category/ai-engineering.html class=md-nav__link> <span class=md-ellipsis> AI Engineering </span> </a> </li> <li class=md-nav__item> <a href=category/advice.html class=md-nav__link> <span class=md-ellipsis> Advice </span> </a> </li> <li class=md-nav__item> <a href=category/applied-ai.html class=md-nav__link> <span class=md-ellipsis> Applied AI </span> </a> </li> <li class=md-nav__item> <a href=category/braintrust.html class=md-nav__link> <span class=md-ellipsis> Braintrust </span> </a> </li> <li class=md-nav__item> <a href=category/career.html class=md-nav__link> <span class=md-ellipsis> Career </span> </a> </li> <li class=md-nav__item> <a href=category/clustering.html class=md-nav__link> <span class=md-ellipsis> Clustering </span> </a> </li> <li class=md-nav__item> <a href=category/comfyui.html class=md-nav__link> <span class=md-ellipsis> ComfyUI </span> </a> </li> <li class=md-nav__item> <a href=category/debugging.html class=md-nav__link> <span class=md-ellipsis> Debugging </span> </a> </li> <li class=md-nav__item> <a href=category/deployment.html class=md-nav__link> <span class=md-ellipsis> Deployment </span> </a> </li> <li class=md-nav__item> <a href=category/diffusion-models.html class=md-nav__link> <span class=md-ellipsis> Diffusion Models </span> </a> </li> <li class=md-nav__item> <a href=category/documentation.html class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=category/evals.html class=md-nav__link> <span class=md-ellipsis> Evals </span> </a> </li> <li class=md-nav__item> <a href=category/evaluation.html class=md-nav__link> <span class=md-ellipsis> Evaluation </span> </a> </li> <li class=md-nav__item> <a href=category/evaluations.html class=md-nav__link> <span class=md-ellipsis> Evaluations </span> </a> </li> <li class=md-nav__item> <a href=category/instructor.html class=md-nav__link> <span class=md-ellipsis> Instructor </span> </a> </li> <li class=md-nav__item> <a href=category/llm.html class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> <li class=md-nav__item> <a href=category/llms.html class=md-nav__link> <span class=md-ellipsis> LLMs </span> </a> </li> <li class=md-nav__item> <a href=category/mcps.html class=md-nav__link> <span class=md-ellipsis> MCPs </span> </a> </li> <li class=md-nav__item> <a href=category/mac.html class=md-nav__link> <span class=md-ellipsis> Mac </span> </a> </li> <li class=md-nav__item> <a href=category/machine-learning.html class=md-nav__link> <span class=md-ellipsis> Machine Learning </span> </a> </li> <li class=md-nav__item> <a href=category/modal.html class=md-nav__link> <span class=md-ellipsis> Modal </span> </a> </li> <li class=md-nav__item> <a href=category/personal.html class=md-nav__link> <span class=md-ellipsis> Personal </span> </a> </li> <li class=md-nav__item> <a href=category/personal-development.html class=md-nav__link> <span class=md-ellipsis> Personal Development </span> </a> </li> <li class=md-nav__item> <a href=category/python.html class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> <li class=md-nav__item> <a href=category/rag.html class=md-nav__link> <span class=md-ellipsis> RAG </span> </a> </li> <li class=md-nav__item> <a href=category/rwkv.html class=md-nav__link> <span class=md-ellipsis> RWKV </span> </a> </li> <li class=md-nav__item> <a href=category/synthetic-data.html class=md-nav__link> <span class=md-ellipsis> Synthetic Data </span> </a> </li> <li class=md-nav__item> <a href=category/testing.html class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=category/trends.html class=md-nav__link> <span class=md-ellipsis> Trends </span> </a> </li> <li class=md-nav__item> <a href=category/ui-generation.html class=md-nav__link> <span class=md-ellipsis> UI Generation </span> </a> </li> <li class=md-nav__item> <a href=category/uiux.html class=md-nav__link> <span class=md-ellipsis> UI/UX </span> </a> </li> <li class=md-nav__item> <a href=category/voice.html class=md-nav__link> <span class=md-ellipsis> Voice </span> </a> </li> <li class=md-nav__item> <a href=category/walkthrough.html class=md-nav__link> <span class=md-ellipsis> Walkthrough </span> </a> </li> <li class=md-nav__item> <a href=category/whisper.html class=md-nav__link> <span class=md-ellipsis> Whisper </span> </a> </li> <li class=md-nav__item> <a href=category/langchain.html class=md-nav__link> <span class=md-ellipsis> langchain </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../work.html class=md-nav__link> <span class=md-ellipsis> Work with me </span> </a> </li> <li class=md-nav__item> <a href=../newsletter.html class=md-nav__link> <span class=md-ellipsis> Newsletter </span> </a> </li> <li class=md-nav__item> <a href=../talk.html class=md-nav__link> <span class=md-ellipsis> Talks </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-idea class=md-nav__link> <span class=md-ellipsis> The Idea </span> </a> </li> <li class=md-nav__item> <a href=#the-code class=md-nav__link> <span class=md-ellipsis> The Code </span> </a> <nav class=md-nav aria-label="The Code"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#data-models class=md-nav__link> <span class=md-ellipsis> Data Models </span> </a> </li> <li class=md-nav__item> <a href=#setting-up-selenium class=md-nav__link> <span class=md-ellipsis> Setting up Selenium </span> </a> </li> <li class=md-nav__item> <a href=#crawling-the-data class=md-nav__link> <span class=md-ellipsis> Crawling the Data </span> </a> </li> <li class=md-nav__item> <a href=#saving-the-data class=md-nav__link> <span class=md-ellipsis> Saving the Data </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#classification-with-gpt class=md-nav__link> <span class=md-ellipsis> Classification with GPT </span> </a> <nav class=md-nav aria-label="Classification with GPT"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pydantic-models class=md-nav__link> <span class=md-ellipsis> Pydantic Models </span> </a> </li> <li class=md-nav__item> <a href=#yake-ing-out-the-keywords class=md-nav__link> <span class=md-ellipsis> Yake-ing out the keywords </span> </a> </li> <li class=md-nav__item> <a href=#gpt-keywords class=md-nav__link> <span class=md-ellipsis> GPT Keywords </span> </a> </li> <li class=md-nav__item> <a href=#categorising class=md-nav__link> <span class=md-ellipsis> Categorising </span> </a> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> <span class=md-ellipsis> Putting it all together </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#building-a-ui class=md-nav__link> <span class=md-ellipsis> Building a UI </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <!-- Sidebar --> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <!-- Back to overview link --> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <div class="md-post__authors md-typeset"> <div class="md-profile md-post__profile"> <span class="md-author md-author--long"> <img src=https://pbs.twimg.com/profile_images/1838778744468836353/utYfioiO_400x400.jpg alt="Ivan Leo"> </span> <span class=md-profile__description> <strong> <a href="https://twitter.com/intent/follow?screen_name=ivanleomk">Ivan Leo</a> </strong> <br> Research Engineer at 567 Labs </span> </div> </div> <!-- Post metadata --> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <!-- Post date --> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg> <time datetime="2023-07-01 00:00:00" class=md-ellipsis>July 1, 2023</time> </div> </li> <!-- Post date updated --> <!-- Post categories --> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg> <span class=md-ellipsis> in <a href=category/llms.html>LLMs</a>, <a href=category/instructor.html>Instructor</a></span> </div> </li> <!-- Post readtime --> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg> <span class=md-ellipsis> 10 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> <!-- Table of contents, if integrated --> </div> </div> </div> <!-- Page content --> <article class="md-content__inner md-typeset"> <h1 id=introduction>Introduction</h1> <blockquote> <p>As usual, you can find the code for this specific article <a href=https://github.com/ivanleomk/scrape-google-maps>here</a></p> </blockquote> <p>If you've ever used Google Maps, you've definitely struggled to decide where to go to eat. The UI ... frankly sucks beyond belief for an application that has all the data and compute that it has.</p> <p><img alt src=images/Google_Maps.png></p> <!-- more --> <p>There's not even a simple way to filter the saved places by keywords, categories or even just the location. You need to manually pan and find something that you like.</p> <p>So i thought I'd crawl it for the fun of it since I wanted more control over my data. I'd seen some jupyter notebooks but no fine-grained script online so I built my own.</p> <h2 id=the-idea>The Idea</h2> <p>When you navigate to a saved location, you see the following</p> <p><img alt src=images/Saved_Location.png></p> <p>You get</p> <ol> <li>The name</li> <li>The overall rating</li> <li>A category that google has assigned to it</li> </ol> <p>among a few other bits of data. But if you use some of the default categories, the amount of data provided is inconsistent. Therefore, here's how our script gets around inconsistent data.</p> <p>We simply visit the page that's linked to the listing!</p> <p><img src=/images/Linked_page.png></p> <p>What makes it even better is that the page link itself contains a lot of valuable information</p> <p>For instance, take the following link to FiftyFive Coffe Bar,</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>https://www.google.com/maps/place/FiftyFive+Coffee+Bar/@1.3731958,103.8075006,12z/data<span class=o>=</span>!4m11!1m3!11m2!2s9wJ7F7C-bjteOlxRQli8-lZz7jeYIw!3e2!3m6!1s0x31da192386bddc8d:0xed0fef7eae8bf927!8m2!3d1.2795647!4d103.8425105!15sCgEqkgEEY2FmZeABAA!16s%2Fg%2F11k50kg36w?entry<span class=o>=</span>ttu
</span></code></pre></div> <p>We can actually extract out things like the lattitude and longtitude from the link. This helps us to perform useful tasks such as geocoding and reverse geocoding.</p> <p>Even the HTML isn't too bad for scrapping with unique class names that we can target as seen below</p> <p><img alt src=images/Google_Html.png></p> <h2 id=the-code>The Code</h2> <h3 id=data-models>Data Models</h3> <p>Before we start coding out any code, let's start by defining some models</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>class</span> <span class=nc>Status</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=n>CLOSED</span> <span class=o>=</span> <span class=s2>&quot;Closed&quot;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=n>TEMPORARILY_CLOSED</span> <span class=o>=</span> <span class=s2>&quot;Temporarily Closed&quot;</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=n>OPEN</span> <span class=o>=</span> <span class=s2>&quot;Open&quot;</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=k>class</span> <span class=nc>Listing</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=n>title</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>    <span class=n>rating</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>    <span class=n>number_of_reviews</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>    <span class=n>address</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=n>review</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>    <span class=n>hasDelivery</span><span class=p>:</span> <span class=nb>bool</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>    <span class=n>hasTakeaway</span><span class=p>:</span> <span class=nb>bool</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>    <span class=n>hasDineIn</span><span class=p>:</span> <span class=nb>bool</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>    <span class=n>category</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>    <span class=n>address</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>    <span class=n>long</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>    <span class=n>lat</span><span class=p>:</span> <span class=nb>float</span>
</span></code></pre></div> <p>The <code>Status</code> class is an enumeration that represents the status of a listing. It has three possible values: <code>CLOSED</code>, <code>TEMPORARILY_CLOSED</code>, and <code>OPEN</code>.</p> <p>The <code>Listing</code> class is a Pydantic model that defines the structure and validation rules for the data related to a specific listing. The fields in this model include:</p> <ul> <li><code>title</code>: The title of the listing (a string)</li> <li><code>rating</code>: The rating of the listing (a float, optional)</li> <li><code>number_of_reviews</code>: The number of reviews for the listing (an integer, optional)</li> <li><code>address</code>: The address of the listing (a string, optional)</li> <li><code>review</code>: A review for the listing (a string)</li> <li><code>hasDelivery</code>: A boolean indicating if the listing offers delivery</li> <li><code>hasTakeaway</code>: A boolean indicating if the listing offers takeaway</li> <li><code>hasDineIn</code>: A boolean indicating if the listing offers dine-in</li> <li><code>category</code>: The category of the listing (a string, optional)</li> <li><code>status</code>: The status of the listing, which should be one of the <code>Status</code> enumeration values (a string)</li> <li><code>url</code>: The URL of the listing (a string)</li> <li><code>long</code>: The longitude of the listing (a float)</li> <li><code>lat</code>: The latitude of the listing (a float)</li> </ul> <p>Now that we have our models, let's start by writing some simple code</p> <h3 id=setting-up-selenium>Setting up Selenium</h3> <blockquote> <p>I strongly suggest using a virtual environment to follow along</p> </blockquote> <p>We can set up a selenium instance to crawl in python by using</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span> <span class=nn>selenium.webdriver.chrome.service</span> <span class=kn>import</span> <span class=n>Service</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>service</span> <span class=o>=</span> <span class=n>Service</span><span class=p>()</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>service</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>()</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=n>list_url</span> <span class=o>=</span> <span class=o>//</span> <span class=n>Your</span> <span class=nb>list</span> <span class=n>url</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>list_url</span><span class=p>)</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></code></pre></div> <h3 id=crawling-the-data>Crawling the Data</h3> <p>This simply code chunk is enough to navigate to your list url. All our crawler does thereafter is just</p> <ol> <li>Click on each item sequentially</li> <li>Navigate to the page that links to the item</li> <li>Extract the data from the page</li> <li>Go back to the original list url</li> </ol> <p><img alt src=images/crawling.gif></p> <p>So, before we can even start crawling, it's important to understand how many items we need to crawl. We can do so with a simple while loop</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>div_element</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=n>By</span><span class=o>.</span><span class=n>CSS_SELECTOR</span><span class=p>,</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=s1>&#39;div[class*=&quot;m6QErb&quot;][class*=&quot;DxyBCb&quot;][class*=&quot;kA9KIf&quot;][class*=&quot;dS8AEf&quot;]&#39;</span><span class=p>,</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=p>)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Starting to crawl list page : </span><span class=si>{</span><span class=n>list_url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1># Scroll down to the specific div element</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=n>last_height</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&quot;return arguments[0].scrollHeight&quot;</span><span class=p>,</span> <span class=n>div_element</span><span class=p>)</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>        <span class=s2>&quot;arguments[0].scrollTo(0, arguments[0].scrollHeight)&quot;</span><span class=p>,</span> <span class=n>div_element</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=p>)</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>html_source</span> <span class=o>=</span> <span class=n>div_element</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s2>&quot;innerHTML&quot;</span><span class=p>)</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=n>curr_height</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>execute_script</span><span class=p>(</span><span class=s2>&quot;return arguments[0].scrollHeight&quot;</span><span class=p>,</span> <span class=n>div_element</span><span class=p>)</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>    <span class=k>if</span> <span class=n>curr_height</span> <span class=o>==</span> <span class=n>last_height</span><span class=p>:</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>        <span class=k>break</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>    <span class=n>last_height</span> <span class=o>=</span> <span class=n>curr_height</span>
</span></code></pre></div> <p>This simply checks the height of the div which contains all our saved items and sees if it has increased in size each time.</p> <p>Once we navigate to a specific window, we can then extract all the data that we need.</p> <p>We first try to find the parent element that contains the data on the listing page</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>def</span> <span class=nf>extract_details_from_window</span><span class=p>(</span><span class=n>driver</span><span class=p>,</span> <span class=n>review</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Listing</span><span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>                <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>                    <span class=n>By</span><span class=o>.</span><span class=n>CSS_SELECTOR</span><span class=p>,</span> <span class=s1>&#39;div[class*=&quot;m6QErb WNBkOb&quot;]:not(:empty)&#39;</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>                <span class=p>)</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>                <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>                    <span class=s2>&quot;Unable to find parent element. Retrying again in 4 seconds...&quot;</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>                <span class=p>)</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></code></pre></div> <p>Once we've validated that we've found the parent element, we parse the content using Beautiful Soup 4.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>parent_container</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>By</span><span class=o>.</span><span class=n>CSS_SELECTOR</span><span class=p>,</span> <span class=s1>&#39;div[class*=&quot;m6QErb WNBkOb&quot;]:not(:empty)&#39;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=p>)</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>parent_container</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s2>&quot;innerHTML&quot;</span><span class=p>),</span> <span class=s2>&quot;html.parser&quot;</span><span class=p>)</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=n>is_empty</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>soup</span><span class=o>.</span><span class=n>contents</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=k>if</span> <span class=n>is_empty</span><span class=p>:</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Parent container is empty&quot;</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Parent container is empty&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>In the event that we cannot find any content - this sometimes happens if we just cannot click the item succesfully. We simply raise an error and move on to the next item.</p> <p>Once we've extracted the data, we can then extract the data from the page.</p> <p>Here's an example of the logs for the data data that we extracted from the bearded bella page</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=o>[</span><span class=m>17</span>:37:18<span class=o>]</span><span class=w> </span>Unable<span class=w> </span>to<span class=w> </span>find<span class=w> </span>parent<span class=w> </span>element.<span class=w> </span>Retrying<span class=w> </span>again<span class=w> </span><span class=k>in</span><span class=w> </span><span class=m>4</span><span class=w>  </span>main.py:70
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>           </span>seconds...
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>           </span>Extracted<span class=w> </span>review<span class=w> </span>as<span class=w> </span>It’s<span class=w> </span>very<span class=w> </span>good<span class=w> </span>-<span class=w> </span>the<span class=w> </span>cold<span class=w>      </span>main.py:100
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>           </span>pasta<span class=w> </span>is<span class=w> </span>to<span class=w> </span>die<span class=w> </span><span class=k>for</span><span class=w> </span>and<span class=w> </span>the<span class=w> </span>coffee<span class=w> </span>is<span class=w> </span>solid.<span class=w> </span>Solid
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>           </span><span class=m>4</span>/5<span class=w> </span>would<span class=w> </span>go<span class=w> </span>back
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=o>[</span><span class=m>17</span>:37:24<span class=o>]</span><span class=w> </span>Extracted<span class=w> </span>out<span class=w> </span>html<span class=w> </span>from<span class=w> </span>parent<span class=w> </span>container<span class=w>           </span>crawl.py:37
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>           </span>Extracted<span class=w> </span>title<span class=w> </span>as<span class=w> </span>Bearded<span class=w> </span>Bella<span class=w>                   </span>crawl.py:39
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>           </span>Extracted<span class=w> </span>status<span class=w> </span>as<span class=w> </span>Open<span class=w>                           </span>crawl.py:53
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>           </span>Extracted<span class=w> </span>rating<span class=w> </span>as<span class=w> </span><span class=m>4</span>.2<span class=w>                            </span>crawl.py:66
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>           </span>Extracted<span class=w> </span>rating<span class=w> </span>as<span class=w> </span><span class=m>790</span><span class=w>                            </span>crawl.py:67
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>           </span>Extracted<span class=w> </span>address<span class=w> </span>as<span class=w> </span><span class=m>8</span><span class=w> </span>Craig<span class=w> </span>Rd,<span class=w> </span>Singapore<span class=w> </span><span class=m>089668</span><span class=w>  </span>crawl.py:75
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>           </span>Extracted<span class=w> </span>lat<span class=w> </span>as<span class=w> </span><span class=m>1</span>.2777283<span class=w> </span>and<span class=w> </span>long<span class=w> </span>as<span class=w> </span><span class=m>103</span>.8428438<span class=w> </span>crawl.py:82
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>           </span>Extracted<span class=w> </span>category<span class=w> </span>as<span class=w> </span>Restaurant<span class=w>                   </span>crawl.py:96
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>           </span>Extracted<span class=w> </span>hasDelivery<span class=w> </span>as<span class=w> </span>False<span class=w>                     </span>crawl.py:97
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>           </span>Extracted<span class=w> </span>hasTakeaway<span class=w> </span>as<span class=w> </span>True<span class=w>                      </span>crawl.py:98
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>           </span>Extracted<span class=w> </span>hasDineIn<span class=w> </span>as<span class=w> </span>True
</span></code></pre></div> <h3 id=saving-the-data>Saving the Data</h3> <p>Once we've extracted out the individual items, we can then write it to a csv file with</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>i</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>]</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>csv_file</span> <span class=o>=</span> <span class=s2>&quot;items.csv&quot;</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>csv_file</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8-sig&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>writer</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=c1># Write the header row</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>writer</span><span class=o>.</span><span class=n>writerow</span><span class=p>(</span><span class=n>Listing</span><span class=o>.</span><span class=n>__fields__</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=c1># Write the data rows</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>            <span class=n>writer</span><span class=o>.</span><span class=n>writerow</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while extracting data: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>            <span class=kn>import</span> <span class=nn>pdb</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>            <span class=n>pdb</span><span class=o>.</span><span class=n>set_trace</span><span class=p>()</span>
</span></code></pre></div> <blockquote> <p>Note that running this specific file will take you quite some time. I suggest running it in the background while you do other things since we implement a good amount of timeouts so we don't get rate limited.</p> </blockquote> <h2 id=classification-with-gpt>Classification with GPT</h2> <p>Now that we have our data, we can go beyond just scraping the data and actually do something with it. In my case, I scrapped a total of ~86 different entries so I went ahead and manually rated them on a scale of 1-10.</p> <p>This gives us a df with the following columns</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=o>&gt;</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>()</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>Index</span><span class=p>([</span><span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;rating&#39;</span><span class=p>,</span> <span class=s1>&#39;number_of_reviews&#39;</span><span class=p>,</span> <span class=s1>&#39;address&#39;</span><span class=p>,</span> <span class=s1>&#39;review&#39;</span><span class=p>,</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>       <span class=s1>&#39;hasDelivery&#39;</span><span class=p>,</span> <span class=s1>&#39;hasTakeaway&#39;</span><span class=p>,</span> <span class=s1>&#39;hasDineIn&#39;</span><span class=p>,</span> <span class=s1>&#39;category&#39;</span><span class=p>,</span> <span class=s1>&#39;status&#39;</span><span class=p>,</span> <span class=s1>&#39;url&#39;</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>       <span class=s1>&#39;long&#39;</span><span class=p>,</span> <span class=s1>&#39;lat&#39;</span><span class=p>,</span> <span class=s1>&#39;country&#39;</span><span class=p>],</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>      <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;object&#39;</span><span class=p>)</span>
</span></code></pre></div> <blockquote> <p>Most of the code here for classification was modified from the following tweet which you can check out <a href=https://twitter.com/_ScottCondron/status/1674420258080452610>here</a></p> </blockquote> <h3 id=pydantic-models>Pydantic Models</h3> <p>As always, we start by defining a simple <code>pydantic</code> model to store our data for each individual restaurant</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>class</span> <span class=nc>Location</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=n>title</span><span class=p>:</span><span class=nb>str</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>rating</span><span class=p>:</span><span class=nb>float</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>number_of_reviews</span><span class=p>:</span><span class=nb>int</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>user_review</span><span class=p>:</span><span class=nb>str</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=n>categories</span><span class=p>:</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span></code></pre></div> <p>We can then create a simple function to extract all of the data from our dataframe</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>locations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>itertuples</span><span class=p>():</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>location</span> <span class=o>=</span> <span class=n>Location</span><span class=p>(</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>        <span class=n>title</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>title</span><span class=p>,</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>        <span class=n>rating</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>rating</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        <span class=n>number_of_reviews</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>number_of_reviews</span><span class=p>,</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>        <span class=n>user_review</span><span class=o>=</span><span class=n>row</span><span class=o>.</span><span class=n>review</span><span class=p>,</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>        <span class=n>categories</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span><span class=o>.</span><span class=n>category</span><span class=p>]</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    <span class=n>locations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>location</span><span class=p>)</span>
</span></code></pre></div> <h3 id=yake-ing-out-the-keywords>Yake-ing out the keywords</h3> <p>We first use use the Yake keyword extractor to extract out all the keywords that are present in our text</p> <blockquote> <p>Yake is a light weight unsupervised automatic keyword extraction algorithm that uses a small set of heuristics to capture keywords. You can check it out <a href=https://github.com/LIAAD/yake>here</a></p> </blockquote> <p>We can install the library by running the following command</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>pip<span class=w> </span>install<span class=w> </span>git+https://github.com/LIAAD/yake
</span></code></pre></div> <p>We can then use the following code to extract out the keywords</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>import</span> <span class=nn>yake</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=n>kw_extractor</span> <span class=o>=</span> <span class=n>yake</span><span class=o>.</span><span class=n>KeywordExtractor</span><span class=p>()</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=n>keywords</span> <span class=o>=</span> <span class=nb>set</span><span class=p>([])</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>itertuples</span><span class=p>():</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=n>formatted_string</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;title: </span><span class=si>{</span><span class=n>row</span><span class=o>.</span><span class=n>title</span><span class=si>}</span><span class=s2>, review: </span><span class=si>{</span><span class=n>row</span><span class=o>.</span><span class=n>review</span><span class=si>}</span><span class=s2>, category: </span><span class=si>{</span><span class=n>row</span><span class=o>.</span><span class=n>category</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=n>new_keywords</span> <span class=o>=</span> <span class=n>kw_extractor</span><span class=o>.</span><span class=n>extract_keywords</span><span class=p>(</span><span class=n>formatted_string</span><span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>extracted_keywords</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>new_keywords</span><span class=p>]</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=k>for</span> <span class=n>extracted_keyword</span> <span class=ow>in</span> <span class=n>extracted_keywords</span><span class=p>:</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=n>keywords</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>extracted_keyword</span><span class=p>)</span>
</span></code></pre></div> <p>Since Yake is simply extracting out semantic bits which might have useful information, we end up with certain tags which aren't very useful. Here are some examples that don't really make sense</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=p>[</span><span class=s1>&#39;AMAZING&#39;</span><span class=p>,</span><span class=s1>&#39;AMAZING DUCK&#39;</span><span class=p>,</span><span class=s1>&#39;AMAZING DUCK BREST&#39;</span><span class=p>]</span>
</span></code></pre></div> <h3 id=gpt-keywords>GPT Keywords</h3> <p>This is where GPT comes in. We basically get it to look at all our keywords and then generate ~30 categories that can convery the same meaning. If you look at my dataset in the github repo, you'll notice that there are also a good amount of non-english words.</p> <p>I was a bit lazy to filter it so I decided to just tell GPT to only consider english categories.</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>python</span> <span class=k>class</span> <span class=nc>Tags</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=n>categories</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=k>def</span> <span class=nf>generate_categories</span><span class=p>(</span><span class=n>keywords</span><span class=p>):</span> <span class=n>keywords_with_new_lines</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>keywords</span><span class=p>)</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=n>prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=s2>    Invent categories for some restaurants. You are about to be provided with a brief description of a restrautn from google maps.</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=s2>    Here are some categories that we have. Only consider english categories.</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=s2>    </span><span class=si>{</span><span class=n>keywords_with_new_lines</span><span class=si>}</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=s2>    Create 30 short categories that semantically group these keywords.</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=s2>    Think step by step</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=s2>    &quot;&quot;&quot;</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>ChatCompletion</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>        <span class=n>model</span> <span class=o>=</span> <span class=s2>&quot;gpt-3.5-turbo-16k&quot;</span><span class=p>,</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>            <span class=p>{</span><span class=s1>&#39;role&#39;</span><span class=p>:</span><span class=s1>&#39;user&#39;</span><span class=p>,</span><span class=s1>&#39;content&#39;</span><span class=p>:</span><span class=n>prompt</span><span class=p>}</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>    <span class=p>]</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>    <span class=n>functions</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>        <span class=p>{</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>            <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;output_categories&#39;</span><span class=p>,</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>            <span class=s1>&#39;description&#39;</span><span class=p>:</span> <span class=s1>&#39;The final list of categories&#39;</span><span class=p>,</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>            <span class=s1>&#39;parameters&#39;</span><span class=p>:</span><span class=n>Tags</span><span class=o>.</span><span class=n>schema</span><span class=p>()</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a>        <span class=p>}</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>    <span class=p>],</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>    <span class=n>function_call</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a>        <span class=s1>&#39;name&#39;</span><span class=p>:</span><span class=s1>&#39;output_categories&#39;</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>    <span class=p>}</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=p>)</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=n>parsed_json</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;message&quot;</span><span class=p>][</span><span class=s2>&quot;function_call&quot;</span><span class=p>][</span><span class=s2>&quot;arguments&quot;</span><span class=p>]</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=n>categories</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>parsed_json</span><span class=p>)[</span><span class=s2>&quot;categories&quot;</span><span class=p>]</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=k>return</span> <span class=n>categories</span>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=n>res</span> <span class=o>=</span> <span class=n>generate_categories</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>keywords</span><span class=p>))</span>
</span></code></pre></div> <p>Since most of my user reviews had been rather sporadic and inconsistent in length, I thought it wouldn't be useful to force gpt to generate a lot of different recomendations but instead simply focus on a small set of categories - 30 seemed like a good number.</p> <h3 id=categorising>Categorising</h3> <p>Once we had our categories, we now need to categorise and assign categories to each individual item with .. gpt again.</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nd>@retry</span><span class=p>(</span><span class=n>tries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>delay</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>def</span> <span class=nf>location</span><span class=p>:</span><span class=n>Location</span><span class=p>,</span><span class=n>categories</span><span class=p>:</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]):</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>joined_categories</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>categories</span><span class=p>)</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=s2>        Given a Restaurant title and a candid user review, return a new list of 4 categories for the following restaurant</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=s2>        You can use the following categories</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s2>        </span><span class=si>{</span><span class=n>joined_categories</span><span class=si>}</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=s2>        Restaurant Title: </span><span class=si>{</span><span class=n>location</span><span class=o>.</span><span class=n>title</span><span class=si>}</span><span class=s2>,</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=s2>        Existing Categories: [</span><span class=si>{</span><span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>location</span><span class=o>.</span><span class=n>categories</span><span class=p>)</span><span class=si>}</span><span class=s2>]</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=s2>        User Review: </span><span class=si>{</span><span class=n>location</span><span class=o>.</span><span class=n>user_review</span><span class=si>}</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=s2>        You MUST only response with each chose category separated by a new line.</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=s2>        You MUST not say anything after finishing.</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=s2>        Your response will be used to tag the paper so don&#39;t say anything!</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=s2>        The 4 Categories:</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=s2>    &quot;&quot;</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=s2>    response = openai.ChatCompletion.create(</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=s2>        model = &quot;gpt-3.5-turbo-16k&quot;,</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=s2>        messages = [</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=s2>            </span><span class=si>{</span><span class=s1>&#39;role&#39;</span><span class=si>:</span><span class=s2>&#39;user&#39;,&#39;content&#39;:prompt</span><span class=si>}</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=s2>        ]</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=s2>    )</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=s2>    return response[&quot;choices&quot;][0][&quot;message&quot;][&quot;content&quot;].split(&quot;</span><span class=se>\n</span><span class=s2>&quot;)</span>
</span></code></pre></div> <p>Over here, we're using the <code>retry</code> package which allows for automatic retries in case the API fails or the function throws an error. This is useful since the API can sometimes fail due to rate limits.</p> <p>I'd like to also throw an error if a response takes too long but I haven't figured out how to do that yet.</p> <h3 id=putting-it-all-together>Putting it all together</h3> <p>Once we've got the categorisation functionality down, all we need is to then work on the actual classification. We can do this by simply iterating through each restaurant and then tagging it with the categories that we generated earlier with our <code>tag_restaurant</code> function.</p> <p>We can do so with the following loop.</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>parsed_locations</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>for</span> <span class=n>location</span> <span class=ow>in</span> <span class=n>locations</span><span class=p>:</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>new_categories</span> <span class=o>=</span> <span class=n>tag_restaurant</span><span class=p>(</span><span class=n>location</span><span class=p>,</span><span class=n>categories</span><span class=p>)</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>new_location</span> <span class=o>=</span> <span class=n>location</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=n>new_location</span><span class=o>.</span><span class=n>categories</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>new_categories</span><span class=p>)</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>    <span class=n>unique_categories</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>        <span class=nb>set</span><span class=p>(</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>            <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>new_location</span><span class=o>.</span><span class=n>categories</span><span class=p>]</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>        <span class=p>)</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>    <span class=p>)</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>    <span class=n>new_location</span><span class=o>.</span><span class=n>categories</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=o>.</span><span class=n>title</span><span class=p>()</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>unique_categories</span><span class=p>]</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>    <span class=n>parsed_locations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>new_location</span><span class=p>)</span>
</span></code></pre></div> <p>before writing it to a csv with the following function</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>def</span> <span class=nf>write_locations_to_csv</span><span class=p>(</span><span class=n>locations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Location</span><span class=p>],</span> <span class=n>file_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>    <span class=n>fieldnames</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>Location</span><span class=o>.</span><span class=n>schema</span><span class=p>()[</span><span class=s2>&quot;properties&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>csvfile</span><span class=p>:</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>        <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictWriter</span><span class=p>(</span><span class=n>csvfile</span><span class=p>,</span> <span class=n>fieldnames</span><span class=o>=</span><span class=n>fieldnames</span><span class=p>)</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>        <span class=n>writer</span><span class=o>.</span><span class=n>writeheader</span><span class=p>()</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>        <span class=k>for</span> <span class=n>location</span> <span class=ow>in</span> <span class=n>locations</span><span class=p>:</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>            <span class=n>writer</span><span class=o>.</span><span class=n>writerow</span><span class=p>(</span><span class=n>location</span><span class=o>.</span><span class=n>dict</span><span class=p>())</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=n>write_locations_to_csv</span><span class=p>(</span><span class=n>parsed_locations</span><span class=p>,</span> <span class=s2>&quot;locations.csv&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>The results aren't honestly too bad - we can see from the quick screengrab that I took that it was able to accurately tag certain places correctly - the function sometime generated duplicate tags and so the use of a set in our code was useful to remove duplicates.</p> <h2 id=building-a-ui>Building a UI</h2> <p>I used streamlit to build a quick UI for us to iterate through the different categories and see what the results were like.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>import</span> <span class=nn>streamlit</span> <span class=k>as</span> <span class=nn>st</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=kn>from</span> <span class=nn>pydantic</span> <span class=kn>import</span> <span class=n>BaseModel</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&quot;./locations.csv&quot;</span><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=n>parsed_categories</span> <span class=o>=</span> <span class=p>[[</span><span class=n>j</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>i</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;&#39;&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s2>&quot;categories&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>()]</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=k>for</span> <span class=n>cat_list</span> <span class=ow>in</span> <span class=n>parsed_categories</span><span class=p>:</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>cat_list</span><span class=p>:</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>        <span class=n>category_set</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>cat</span><span class=p>)</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=n>st</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&quot;Location Filter&quot;</span><span class=p>)</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=c1># Filter by title</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=n>title_filter</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>sidebar</span><span class=o>.</span><span class=n>text_input</span><span class=p>(</span><span class=s2>&quot;Search by title&quot;</span><span class=p>)</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=n>filtered_df</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s2>&quot;title&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span><span class=n>title_filter</span><span class=p>,</span> <span class=n>case</span><span class=o>=</span><span class=kc>False</span><span class=p>)]</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=c1># Filter by categories</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=n>unique_categories</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>category_set</span><span class=p>)</span>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a><span class=n>selected_categories</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>sidebar</span><span class=o>.</span><span class=n>multiselect</span><span class=p>(</span><span class=s2>&quot;Filter by categories&quot;</span><span class=p>,</span> <span class=n>unique_categories</span><span class=p>)</span>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=n>filtered_df</span> <span class=o>=</span> <span class=n>filtered_df</span><span class=p>[</span><span class=n>filtered_df</span><span class=p>[</span><span class=s2>&quot;categories&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=nb>any</span><span class=p>(</span><span class=n>category</span> <span class=ow>in</span> <span class=n>x</span> <span class=k>for</span> <span class=n>category</span> <span class=ow>in</span> <span class=n>selected_categories</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>len</span><span class=p>(</span><span class=n>selected_categories</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a><span class=nb>print</span><span class=p>(</span><span class=n>unique_categories</span><span class=p>)</span>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=c1># Filter by number of reviews</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=n>min_reviews</span><span class=p>,</span> <span class=n>max_reviews</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>sidebar</span><span class=o>.</span><span class=n>slider</span><span class=p>(</span>
</span><span id=__span-18-31><a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a><span class=s2>&quot;Filter by number of reviews&quot;</span><span class=p>,</span>
</span><span id=__span-18-32><a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=nb>int</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s2>&quot;number_of_reviews&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>min</span><span class=p>()),</span>
</span><span id=__span-18-33><a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=nb>int</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s2>&quot;number_of_reviews&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>()),</span>
</span><span id=__span-18-34><a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s2>&quot;number_of_reviews&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>max</span><span class=p>())),</span>
</span><span id=__span-18-35><a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=p>)</span>
</span><span id=__span-18-36><a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a><span class=n>filtered_df</span> <span class=o>=</span> <span class=n>filtered_df</span><span class=p>[</span>
</span><span id=__span-18-37><a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a><span class=p>(</span><span class=n>filtered_df</span><span class=p>[</span><span class=s2>&quot;number_of_reviews&quot;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=n>min_reviews</span><span class=p>)</span>
</span><span id=__span-18-38><a id=__codelineno-18-38 name=__codelineno-18-38 href=#__codelineno-18-38></a><span class=o>&amp;</span> <span class=p>(</span><span class=n>filtered_df</span><span class=p>[</span><span class=s2>&quot;number_of_reviews&quot;</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>max_reviews</span><span class=p>)</span>
</span><span id=__span-18-39><a id=__codelineno-18-39 name=__codelineno-18-39 href=#__codelineno-18-39></a><span class=p>]</span>
</span><span id=__span-18-40><a id=__codelineno-18-40 name=__codelineno-18-40 href=#__codelineno-18-40></a>
</span><span id=__span-18-41><a id=__codelineno-18-41 name=__codelineno-18-41 href=#__codelineno-18-41></a><span class=c1># view_df = filtered_df[[&quot;title&quot;, &quot;number_of_reviews&quot;, &quot;categories&quot;]]</span>
</span><span id=__span-18-42><a id=__codelineno-18-42 name=__codelineno-18-42 href=#__codelineno-18-42></a>
</span><span id=__span-18-43><a id=__codelineno-18-43 name=__codelineno-18-43 href=#__codelineno-18-43></a><span class=c1># Display the filtered DataFrame</span>
</span><span id=__span-18-44><a id=__codelineno-18-44 name=__codelineno-18-44 href=#__codelineno-18-44></a>
</span><span id=__span-18-45><a id=__codelineno-18-45 name=__codelineno-18-45 href=#__codelineno-18-45></a><span class=n>st</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>filtered_df</span><span class=p>[[</span><span class=s2>&quot;title&quot;</span><span class=p>,</span> <span class=s2>&quot;number_of_reviews&quot;</span><span class=p>,</span> <span class=s2>&quot;rating&quot;</span><span class=p>,</span> <span class=s2>&quot;user_review&quot;</span><span class=p>]])</span>
</span></code></pre></div> <p>This is what the UI looks like</p> <p><img alt src=images/streamlit-ui.gif></p> <!-- Add social sharing buttons --> <div class=md-social-share style="margin: 2rem 0; text-align: center"> <span class=md-social-share__label style="display: block; margin-bottom: 1rem; font-weight: 500">Share this post:</span> <div class=md-social-share__buttons style="display: flex; gap: 1rem; justify-content: center"> <a href="https://x.com/intent/tweet?text=Classifying%20Google%20Map%20locations%20with%20LLMs&url=https://ivanleo.com/blog/classifying-google-map-locations-with-llms.html" class=md-social-share__button style="
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background: #000;
            color: #fff;
            text-decoration: none;
            transition: opacity 0.2s;
          " target=_blank rel=noopener> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg> <span style="margin-left: 0.5rem">Share on X</span> </a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ivanleo.com/blog/classifying-google-map-locations-with-llms.html&title=Classifying%20Google%20Map%20locations%20with%20LLMs&summary=&source=" class=md-social-share__button style="
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background: #0077b5;
            color: #fff;
            text-decoration: none;
            transition: opacity 0.2s;
          " target=_blank rel=noopener> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"/></svg> <span style="margin-left: 0.5rem">Share on LinkedIn</span> </a> </div> </div> <div class=newsletter-section style="margin: 2rem 0"> <script async data-uid=b184c2f91e src=https://ivan-leo.kit.com/b184c2f91e/index.js></script> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.copy", "content.code.annotate", "navigation.tabs", "toc.follow", "navigation.path"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.83f73b43.min.js></script> <script src=../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>